{% extends 'base.html' %}
{% load static %}

{% block title %}Manage Questions - {{ assignment.title }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-lg-2 col-md-3 d-md-block sidebar p-3">
            <ul class="nav flex-column">
                <li class="nav-item">
                    <a class="nav-link" href="#">
                        <i class="bi bi-speedometer2"></i> Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="#">
                        <i class="bi bi-journal-text"></i> Courses
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">
                        <i class="bi bi-people"></i> Students
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">
                        <i class="bi bi-graph-up"></i> Analytics
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">
                        <i class="bi bi-chat-left-text"></i> Messages
                        <span class="badge bg-danger rounded-pill ms-1">3</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">
                        <i class="bi bi-calendar-event"></i> Calendar
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">
                        <i class="bi bi-question-circle"></i> Help
                    </a>
                </li>
            </ul>
        </div>

        <!-- Main Content -->
        <main class="col-lg-10 col-md-9 ms-sm-auto main-content">
            <!-- Header Section -->
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center mb-4">
                <div>
                    <h1 class="h2 fw-bold">Manage Questions</h1>
                    <p class="text-muted mb-0">{{ assignment.title }} - {{ assignment.course.title }}</p>
                    <small>Total Questions: {{ questions.count }} / {{ assignment.total_questions }}</small>
                </div>
                <div class="btn-toolbar mb-2 mb-md-0">
                    <a href="{% url 'courses:add_question' assignment.id %}" class="btn btn-primary">
                        <i class="bi bi-plus-circle"></i> Add Question
                    </a>
                </div>
            </div>

            <!-- Progress Bar -->
            <div class="card mb-4">
                <div class="card-body">
                    <div class="d-flex justify-content-between mb-2">
                        <span class="fw-semibold">Assignment Completion</span>
                        <span class="fw-bold text-primary">{{ completion_percentage }}%</span>
                    </div>
                    <div class="progress">
                        <div class="progress-bar bg-primary" role="progressbar" style="width: {{ completion_percentage }}%"></div>
                    </div>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="row mb-4">
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="card stats-card">
                        <div class="value text-primary">{{ questions.count }}</div>
                        <div class="label">Questions Added</div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="card stats-card">
                        <div class="value text-success">{{ multiple_choice_count }}</div>
                        <div class="label">Multiple Choice</div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="card stats-card">
                        <div class="value text-info">{{ short_answer_count }}</div>
                        <div class="label">Short Answer</div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="card stats-card">
                        <div class="value text-warning">{{ total_points }}</div>
                        <div class="label">Total Points</div>
                    </div>
                </div>
            </div>

            <!-- Alert Messages -->
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        <i class="bi bi-check-circle-fill me-2"></i>
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}

            <!-- Questions Table -->
            {% if questions %}
            <div class="card">
                <div class="card-header bg-white">
                    <h5 class="card-title mb-0 fw-bold">Assignment Questions</h5>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th scope="col" class="ps-4">#</th>
                                    <th scope="col">Question</th>
                                    <th scope="col">Type</th>
                                    <th scope="col">Correct Answer</th>
                                    <th scope="col">Points</th>
                                    <th scope="col" class="text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for question in questions %}
                                <tr>
                                    <td class="ps-4 fw-semibold">{{ forloop.counter }}</td>
                                    <td>{{ question.question_text|truncatewords:8 }}</td>
                                    <td>
                                        <span class="badge 
                                            {% if question.question_type == 'multiple_choice' %}bg-success
                                            {% elif question.question_type == 'short_answer' %}bg-info
                                            {% else %}bg-secondary{% endif %}">
                                            {{ question.get_question_type_display }}
                                        </span>
                                    </td>
                                    <td>{{ question.correct_answer|truncatewords:4 }}</td>
                                    <td><span class="fw-bold text-primary">{{ question.points }}</span></td>
                                    <td class="text-center action-buttons">
                                        <a href="{% url 'courses:view_question' question.id %}" class="btn btn-sm btn-outline-primary">
                                            <i class="bi bi-eye"></i> View
                                        </a>
                                        <a href="{% url 'courses:edit_question' question.id %}" class="btn btn-sm btn-outline-secondary">
                                            <i class="bi bi-pencil"></i> Edit
                                        </a>
                                        <a href="{% url 'courses:delete_question' question.id %}" class="btn btn-sm btn-outline-danger" 
                                           onclick="return confirm('Are you sure you want to delete this question? This action cannot be undone.');">
                                            <i class="bi bi-trash"></i> Delete
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {% else %}
            <div class="alert alert-info mt-4" role="alert">
                <i class="bi bi-info-circle-fill me-2"></i>
                No questions added yet. Click <strong>Add Question</strong> to start adding them.
            </div>
            {% endif %}

            <!-- Footer Actions -->
            <div class="d-flex justify-content-between mt-4">
                <a href="{% url 'courses:manage_assignments' course_pk=assignment.course.pk %}" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left"></i> Back to Assignments
                </a>
                <div>
                    <a href="{% url 'courses:preview_assignment' assignment.id %}" class="btn btn-outline-primary me-2">
                        <i class="bi bi-eye"></i> Preview Assignment
                    </a>
                    <a href="{% url 'courses:publish_assignment' assignment.id %}" class="btn btn-success">
                        <i class="bi bi-check-circle"></i> Publish Assignment
                    </a>
                </div>
            </div>
        </main>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    :root {
        --primary-color: #4361ee;
        --secondary-color: #3f37c9;
        --success-color: #4cc9f0;
        --light-bg: #f8f9fa;
        --dark-bg: #212529;
        --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        --hover-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
    }
    
    .sidebar {
        background: linear-gradient(180deg, var(--primary-color) 0%, var(--secondary-color) 100%);
        color: white;
        min-height: calc(100vh - 56px);
        transition: all 0.3s;
    }
    
    .sidebar .nav-link {
        color: rgba(255, 255, 255, 0.8);
        padding: 0.75rem 1rem;
        margin: 0.125rem 0;
        border-radius: 0.375rem;
    }
    
    .sidebar .nav-link:hover, .sidebar .nav-link.active {
        color: white;
        background-color: rgba(255, 255, 255, 0.1);
    }
    
    .sidebar .nav-link i {
        margin-right: 0.5rem;
    }
    
    .main-content {
        background-color: #f5f7fb;
        padding: 1.5rem;
    }
    
    .card {
        border: none;
        border-radius: 0.75rem;
        box-shadow: var(--card-shadow);
        transition: transform 0.2s, box-shadow 0.2s;
        margin-bottom: 1.5rem;
    }
    
    .card:hover {
        transform: translateY(-5px);
        box-shadow: var(--hover-shadow);
    }
    
    .card-header {
        background-color: white;
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        padding: 1.25rem 1.5rem;
        border-radius: 0.75rem 0.75rem 0 0 !important;
    }
    
    .btn-primary {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
        padding: 0.5rem 1.25rem;
        border-radius: 0.5rem;
        font-weight: 500;
    }
    
    .btn-primary:hover {
        background-color: var(--secondary-color);
        border-color: var(--secondary-color);
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(67, 97, 238, 0.3);
    }
    
    .table th {
        border-top: none;
        font-weight: 600;
        color: #495057;
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        padding: 1rem 0.75rem;
    }
    
    .table td {
        padding: 1rem 0.75rem;
        vertical-align: middle;
    }
    
    .badge {
        padding: 0.5rem 0.75rem;
        font-weight: 500;
        border-radius: 0.375rem;
    }
    
    .progress {
        height: 0.5rem;
        border-radius: 1rem;
    }
    
    .alert {
        border: none;
        border-radius: 0.75rem;
        padding: 1rem 1.25rem;
    }
    
    .stats-card {
        text-align: center;
        padding: 1.5rem;
    }
    
    .stats-card .value {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 0.25rem;
    }
    
    .stats-card .label {
        font-size: 0.875rem;
        color: #6c757d;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .action-buttons .btn {
        margin-right: 0.5rem;
        margin-bottom: 0.5rem;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
        .sidebar {
            min-height: auto;
            margin-bottom: 1rem;
        }
        
        .table-responsive {
            border: none;
        }
        
        .action-buttons .btn {
            display: block;
            width: 100%;
        }
    }
    
    @media (max-width: 576px) {
        .main-content {
            padding: 1rem;
        }
        
        .card-header {
            padding: 1rem;
        }
        
        .btn-primary {
            width: 100%;
            margin-top: 0.5rem;
        }
    }
    
    /* Animation for alerts */
    .alert-dismissible {
        animation: slideIn 0.3s ease-out;
    }
    
    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
</style>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Simple confirmation for delete actions
        const deleteButtons = document.querySelectorAll('.btn-outline-danger');
        
        deleteButtons.forEach(button => {
            button.addEventListener('click', function(e) {
                if (!confirm('Are you sure you want to delete this question? This action cannot be undone.')) {
                    e.preventDefault();
                }
            });
        });
        
        // Add animation to cards on scroll
        const observerOptions = {
            threshold: 0.1,
            rootMargin: '0px 0px -50px 0px'
        };
        
        const observer = new IntersectionObserver(function(entries) {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.style.opacity = 1;
                    entry.target.style.transform = 'translateY(0)';
                }
            });
        }, observerOptions);
        
        document.querySelectorAll('.card').forEach(card => {
            card.style.opacity = 0;
            card.style.transform = 'translateY(20px)';
            card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
            observer.observe(card);
        });
    });
</script>
{% endblock %}