<div class="code-assignment">
    <h5>Problem Statement</h5>
    <div class="card mb-4">
        <div class="card-body">
            <p class="card-text">{{ question.problem_statement|linebreaks }}</p>
        </div>
    </div>

    {% if question.starter_code %}
    <div class="card mb-4">
        <div class="card-header">
            <h6 class="mb-0">Starter Code</h6>
        </div>
        <div class="card-body">
            <pre class="bg-light p-3 rounded"><code>{{ question.starter_code }}</code></pre>
        </div>
    </div>
    {% endif %}

    {% if not submission %}
    <form method="post">
        {% csrf_token %}
        <h5 class="mb-3">Write your solution:</h5>
        
        <div class="mb-3">
            <label for="id_language" class="form-label">Programming Language</label>
            <select name="language" id="id_language" class="form-select" required>
                <option value="python" {% if question.language == 'python' %}selected{% endif %}>Python</option>
                <option value="javascript" {% if question.language == 'javascript' %}selected{% endif %}>JavaScript</option>
                <option value="java" {% if question.language == 'java' %}selected{% endif %}>Java</option>
                <option value="cpp" {% if question.language == 'cpp' %}selected{% endif %}>C++</option>
                <option value="c" {% if question.language == 'c' %}selected{% endif %}>C</option>
            </select>
        </div>

        <div class="mb-3">
            <label for="id_code" class="form-label">Your Code</label>
            <textarea name="code" id="id_code" class="form-control code-editor" rows="15" 
                      placeholder="Write your code here..." required
                      {% if question.starter_code %}data-starter-code="{{ question.starter_code }}"{% endif %}>
                {% if question.starter_code %}{{ question.starter_code }}{% endif %}
            </textarea>
        </div>

        <div class="mt-4">
            <button type="submit" class="btn btn-primary">
                <i class="bi bi-play-circle me-2"></i>Run & Submit
            </button>
            <small class="text-muted ms-3">
                <i class="bi bi-info-circle me-1"></i>
                Your code will be tested against multiple test cases
            </small>
        </div>
    </form>
    {% else %}
        <!-- Show submission results -->
        <div class="submission-result {% if submission.is_correct %}success{% else %}error{% endif %}">
            <h6>
                <i class="bi bi-{% if submission.is_correct %}check-circle{% else %}x-circle{% endif %} me-2"></i>
                Submission Results
            </h6>
            
            <p><strong>Score:</strong> {{ submission.score|floatformat:1 }}/{{ assignment.points }}</p>
            
            {% if submission.code_submission.execution_result %}
                {% with result=submission.code_submission.execution_result %}
                <div class="mt-3">
                    <strong>Execution Results:</strong>
                    <div class="mt-2">
                        {% for test_result in result.results %}
                        <div class="test-case {% if test_result.passed %}passed{% else %}failed{% endif %}">
                            <div class="d-flex justify-content-between">
                                <strong>Test Case {{ test_result.test_case }}</strong>
                                <span class="badge bg-{% if test_result.passed %}success{% else %}danger{% endif %}">
                                    {% if test_result.passed %}PASSED{% else %}FAILED{% endif %}
                                </span>
                            </div>
                            <div class="mt-1">
                                <small>
                                    <strong>Input:</strong> {{ test_result.input }}<br>
                                    <strong>Expected:</strong> {{ test_result.expected }}<br>
                                    <strong>Actual:</strong> {{ test_result.actual }}
                                </small>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    
                    {% if result.status == 'error' %}
                    <div class="alert alert-danger mt-3">
                        <strong>Error:</strong> {{ result.message }}
                    </div>
                    {% endif %}
                </div>
                {% endwith %}
            {% endif %}
            
            <div class="mt-3">
                <h6>Your Submitted Code:</h6>
                <pre class="bg-dark text-light p-3 rounded"><code>{{ submission.code_submission.code }}</code></pre>
            </div>
        </div>
    {% endif %}
</div>